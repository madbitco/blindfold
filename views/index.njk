{% set page_title = page.title or meta.subtitle or '' %}
{% set page_desc = page_description or meta.description or '' %}

{% extends "layouts/main.njk" %}

{% block body %}
<main class="pa3 pa4-m mw6 ml-auto mr-auto">
  <p class="tc mv1">Disable retweets from the people you follow.</p>
  <p class="tc mv1"><strong>All at once</strong>. {{ "Why?" if not user }}</p>
  
  {% if not user %}
    <p>Because not seeing retweets in your feed will help your mind <strong>stay free of the negativity</strong> and bullshit that it is.</p>
    <p class="mv4">
      <a href="{{ base_url }}/auth" class="btn btn-primary db">Sign in with Twitter</a>
    </p>
    <p class="lh-title tc"><small>You will have to confirm your intention after authorising the app with Twitter.</small></p>
  {% else %}
    
    {% verbatim %}

    <div class="flex justify-center" id="app">
      <div>
        <p v-if="rtBlocked > 0" class="tc">You currently block retweets for <strong>{{ rtBlocked }}</strong> followers.</p>
      </div>
    </div>

    {% endverbatim %}
    {# 
    <p class="mv4">
      <a href="{{ base_url }}/wrap" class="btn btn-primary db ttu">Restore my sanity</a>
    </p>
    #}
  {% endif %}
</main>
{% endblock %}

{% block scripts %}
  {% if user %}
    <script>
      /* global Vue */
      /* eslint indent: 0 */
      var app = new Vue({
        el: '#app',
        data: {
          rtBlocked: ''
        },
        mounted: function () {
          var _self = this;
          _self.$nextTick(function () {
            fetch('/wrap').then(function (response) {
              return response.json();
            }).then(function (json) {
              _self.rtBlocked = json.retweeters_blocked;
            });
          });
        }
      });
    </script>
  {% endif %}
{% endblock %}
